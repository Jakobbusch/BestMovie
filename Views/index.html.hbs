<!DOCTYPE html>
<html>
<head>
<link href="/assets/style.css" rel="stylesheet" type="text/css" />

<script src ="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script type="module" >

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
import { getAuth, signInWithRedirect , GoogleAuthProvider, onAuthStateChanged ,signOut  } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";

import model from "/assets/Model.js"
import viewModel from "/assets/ViewModel.js"


window.init =async function(){
	
	
	const movie=''
	const toplist = await fetch('http://localhost:8080/toplists').then(res => res.json())
	const theModel = model(movie, toplist)
	const vm = viewModel(document.getElementById('base'), theModel)
	const app = new Vue(vm)
	
	
}
const firebaseConfig = {
  apiKey: "AIzaSyBjMvVKgFVEr2XHD8t3Ot5ukXFO9W4MUDk",
  authDomain: "semester6project.firebaseapp.com",
  projectId: "semester6project",
  storageBucket: "semester6project.appspot.com",
  messagingSenderId: "12632593485",
  appId: "1:12632593485:web:a9ee8e9b6ec0faa701b804"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

const auth = getAuth();

auth.languageCode = 'it';
const provider = new GoogleAuthProvider();
 provider.addScope('https://www.googleapis.com/auth/contacts.readonly');
  provider.setCustomParameters({
    'login_hint': 'xxx@gmail.com'
  });



(function () {
 
  function loginGoogle() {
    signInWithRedirect(auth, provider); 
  }
  document.getElementById('buttonLogin').addEventListener('click', loginGoogle, true);
})();

 
(function () {

  function logout() {
        signOut(auth).then(() => {
       console.log("You have been signed out")
    }).catch((error) => {
      console.log("Error")
    });
  }
  document.getElementById('buttonLogout').addEventListener('click', logout, true);
})();

const user = auth.currentUser;
onAuthStateChanged(auth, (user) => {
  if (user) {
    // User is signed in, see docs for a list of available properties
    // https://firebase.google.com/docs/reference/js/firebase.User
    const uid = user.uid;
    
    if (user !== null) {
    user.providerData.forEach((profile) => {
      document.getElementById('loginHide').style.visibility = 'visible';
      console.log("Sign-in provider: " + profile.providerId);
      console.log("  Provider-specific UID: " + profile.uid);
      console.log("  Name: " + profile.displayName);
      console.log("  Email: " + profile.email);
      console.log("  Photo URL: " + profile.photoURL);
      console.log("{{maybe}}");
  });
}
  } else {
    console.log("Login is NOT Working!")
    document.getElementById('loginHide').style.visibility = 'hidden';
  }
});




</script>
</head>
<body onload = "init()">
	<div id="base">

    {{maybe}}
  
  
  <div id="loginHide">
	
 <div id="headerNav"> <a href="#home">Home</a><a href="#profilepage">Profile Page</a></div>
  
</div>
    <button class="btn btn-success" type="button" id="buttonLogin">Google Login</button>

     <button class="btn btn-success" type="button" id="buttonLogout">Logout</button>
  
  

  
  <div class="content" id="loginHide">


    <section id="home" >
      

      <div id="searchFieldDiv">
			<input id="searchField" v-model:value='movieTitle' type="search"><button @click='search()'>Search</button>
		</div>
<div id="MovieData" class="parent">
		<div id='Title' class="child child-1">
		<label>Title</label><br>
		<textarea v-model:value = 'movie.Title' id='normal' style="readonly"disabled></textarea>	
		</div>
		<div id='rel' class="child child-2">
		<label>Release</label><br>
		<textarea v-model:value = 'movie.Released' id='normal' style="readonly" disabled></textarea>
		</div>
		<div id='rel' class="child child-3">
		<label>Genre</label><br>
		<textarea v-model:value = 'movie.Genre' id='normal' style="readonly"disabled></textarea>
		</div>
		<div id='rel' class="child child-4">
		<label>Director</label><br>
		<textarea v-model:value = 'movie.Director' id='normal' style="readonly"disabled></textarea>
		</div>
		<div id='rel' class="child child-5">
		<label>Imd Rating</label><br>
		<textarea v-model:value = 'movie.imdbRating' id='normal' style="readonly"disabled></textarea>
		</div>
		<div id='rel' class="child child-6">
			<label>Votes</label><br>
		<textarea v-model:value = 'movie.imdbVotes' id='normal' style="readonly"disabled></textarea>
		</div>	
		<div id='rel' class="child child-7">
			<label>Actors</label><br>
		<textarea v-model:value = 'movie.Actors' id='normal' style="readonly"disabled></textarea>
		</div>
		<div id='rel' class="child child-8">
			<label>Plot</label><br>
		<textarea v-model:value = 'movie.Plot' id='normal' style="height:150px;" disabled></textarea>
		</div>
		<div id='rel' class="child child-9">
				<img id='poster'v-bind:src='movie.Poster'>
		</div>

		</div>
		<button id='addToFav' @click='addToFavourite()' style="float: right;">Add to Favorites</button>
		 

    </section>

    <section id="profilepage">
      <h2>Profile Page</h2>
	  <button @click='writeToConsole()'>Yes</button>

	  <div id="favListDiv">


		  <table id="favList">
			  <h2>Favorite List</h2>
			  <select class="selectpicker" data-style="btn-info" name="selectpicker">
        <optgroup label="Select Table">
            <option name="FavList1" value="0">Fav. List 1</option>
            <option name="FavList2" value="1">Fav. List 2</option>
        </optgroup>
    </select>
  
    <thead><tr><td>Movie Name</td><td>Release</td></tr></thead>
	<tbody id="movieData">
		<tr v-for ='t in toplist'>
			<td>\{{t.UserID}}</td>
			<td>\{{t.MovieID}}</td>

		</tr>
	</tbody>
</table>
	  </div>
	  <div id="otherfavListDiv">
		  <table id="favList">
			  <h2>user's Favorite List</h2>
			  <select class="selectpicker" data-style="btn-info" name="selectpicker">
        <optgroup label="Select Table">
            <option name="" value="0">Most Liked List</option>
            <option name="FavList1" value="1">User 1</option>
            <option name="FavList2" value="2">User 2</option>
        </optgroup>
    </select>
  
    <thead><tr><td>Movie Name</td><td>Release</td></tr></thead>
	<tbody>
		<tr v-for ='m in movie'>
			<td>\{{m.Title}}</td>
			<td>\{{m.Released}}</td>

		</tr>
	</tbody>
</table>
	  </div>
    </section>
    
  
  </div>



  </div>



<footer>
	<h2>Best Movies Platform</h2>
	<p>Share your enthusiasm with fellow movie lovers</p>
</footer>
</body>

</html>